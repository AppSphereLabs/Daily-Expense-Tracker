<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Expense Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #f1f5f9;
            --accent: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --success: #10b981;
            --dark: #1e293b;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            --white: #ffffff;
            --radius: 12px;
            --radius-sm: 8px;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            color: var(--gray-800);
            font-size: 14px;
            line-height: 1.6;
        }

        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 24px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: var(--white);
        }

        .header h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            letter-spacing: -0.025em;
        }

        .header p {
            font-size: 1.125rem;
            opacity: 0.9;
            font-weight: 300;
        }

        /* Auth Sections */
        .auth-section {
            background: var(--white);
            padding: 48px 40px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-xl);
            text-align: center;
            margin: 0 auto;
            max-width: 440px;
            display: none;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .auth-section.active {
            display: block;
        }

        .auth-section h2 {
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 32px;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .auth-form input {
            padding: 16px;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.2s ease;
            background: var(--white);
        }

        .auth-form input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .auth-form button {
            padding: 16px 24px;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            font-family: inherit;
            color: var(--white);
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            transition: all 0.2s ease;
            box-shadow: var(--shadow-sm);
        }

        .auth-form button:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .auth-form button:active {
            transform: translateY(0);
        }

        .auth-switch {
            margin-top: 24px;
            font-size: 0.9rem;
            color: var(--gray-600);
        }

        .auth-switch a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s ease;
        }

        .auth-switch a:hover {
            color: var(--primary-dark);
        }

        .info-message {
            font-size: 0.875rem;
            color: var(--gray-500);
            margin: 16px 0;
            padding: 12px;
            background: var(--gray-50);
            border-radius: var(--radius-sm);
            border-left: 4px solid var(--info);
        }

        /* Dashboard */
        .dashboard-section {
            display: none;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            background: var(--white);
            padding: 24px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }

        .dashboard-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        .dashboard-header button {
            padding: 12px 20px;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 500;
            font-family: inherit;
            color: var(--white);
            background: var(--danger);
            transition: all 0.2s ease;
            box-shadow: var(--shadow-sm);
        }

        .dashboard-header button:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }

        /* Summary Cards */
        .summary-card-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .summary-card {
            background: var(--white);
            padding: 32px 24px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            transition: all 0.2s ease;
        }

        .summary-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
        }

        .summary-card.income-card::before {
            background: linear-gradient(90deg, var(--success), #22c55e);
        }

        .summary-card.expense-card::before {
            background: linear-gradient(90deg, var(--danger), #f87171);
        }

        .summary-card h2 {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .summary-card p {
            font-size: 2rem;
            font-weight: 700;
            line-height: 1;
        }

        .summary-card .income { color: var(--success); }
        .summary-card .expense { color: var(--danger); }
        .summary-card .balance { color: var(--primary); }

        /* Form Sections */
        .form-section, .budget-section, .transactions-section, .settings-section, .reports-section {
            background: var(--white);
            padding: 32px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 32px;
        }

        .form-section h2, .budget-section h2, .transactions-section h2, .settings-section h2, .reports-section h2 {
            margin-bottom: 24px;
            color: var(--gray-900);
            font-size: 1.25rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-section form {
            display: grid;
            gap: 20px;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 8px;
        }

        .form-section input, .form-section select, .form-section button,
        .budget-section input, .budget-section button,
        .settings-section input, .settings-section select, .settings-section button {
            padding: 12px 16px;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            font-family: inherit;
            transition: all 0.2s ease;
            background: var(--white);
        }

        .form-section input:focus, .form-section select:focus,
        .budget-section input:focus,
        .settings-section input:focus, .settings-section select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-section button, .budget-section button, .settings-section button {
            background: var(--primary);
            color: var(--white);
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            box-shadow: var(--shadow-sm);
        }

        .form-section button:hover, .budget-section button:hover, .settings-section button:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .form-section button[type="submit"] {
            grid-column: 1 / -1;
            justify-self: start;
            min-width: 140px;
        }

        /* Settings specific styles */
        .settings-section .settings-option, .budget-section .budget-form {
            display: flex;
            gap: 16px;
            align-items: end;
            margin-bottom: 24px;
        }

        .settings-section .settings-option:last-child {
            margin-bottom: 0;
        }

        .settings-section .settings-option > label {
            min-width: 140px;
            margin-bottom: 0;
            display: flex;
            align-items: center;
            font-weight: 500;
        }

        .settings-section .settings-option select,
        .settings-section .settings-option input,
        .budget-section .budget-form input {
            flex: 1;
        }

        /* Budget Progress */
        .budget-progress-container {
            width: 100%;
            background-color: var(--gray-200);
            border-radius: 20px;
            margin-top: 20px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .budget-progress-bar {
            height: 32px;
            background: linear-gradient(90deg, var(--success), #22c55e);
            text-align: center;
            line-height: 32px;
            color: var(--white);
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.4s ease;
            border-radius: 20px;
        }

        /* Transaction List */
        #transactionList {
            list-style: none;
            padding: 0;
            margin-top: 20px;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--gray-100);
            transition: all 0.2s ease;
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
        }

        .transaction-item:hover {
            background: var(--gray-50);
        }

        .transaction-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .transaction-item .description {
            font-weight: 600;
            color: var(--gray-900);
            font-size: 0.95rem;
        }

        .transaction-item .details {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .transaction-item .amount {
            font-weight: 600;
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            min-width: 80px;
            text-align: center;
        }

        .transaction-item .expense-amount {
            color: var(--white);
            background: var(--danger);
        }

        .transaction-item .income-amount {
            color: var(--white);
            background: var(--success);
        }

        .transaction-item .date {
            font-size: 0.8rem;
            color: var(--gray-500);
            min-width: 80px;
        }

        .transaction-item .action-buttons {
            display: flex;
            gap: 8px;
        }

        .transaction-item .action-buttons .edit-btn,
        .transaction-item .action-buttons .delete-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .transaction-item .action-buttons .edit-btn {
            color: var(--info);
            background: rgba(59, 130, 246, 0.1);
        }

        .transaction-item .action-buttons .edit-btn:hover {
            background: rgba(59, 130, 246, 0.2);
        }

        .transaction-item .action-buttons .delete-btn {
            color: var(--danger);
            background: rgba(239, 68, 68, 0.1);
        }

        .transaction-item .action-buttons .delete-btn:hover {
            background: rgba(239, 68, 68, 0.2);
        }

        #seeMoreBtn {
            margin-top: 20px;
            width: 100%;
            padding: 16px;
            background: var(--gray-100);
            color: var(--gray-700);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 500;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        #seeMoreBtn:hover {
            background: var(--gray-200);
            border-color: var(--gray-300);
        }

        /* Reports */
        .reports-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 32px;
        }

        .chart-container {
            background: var(--white);
            padding: 32px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            transition: all 0.2s ease;
        }

        .chart-container:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .chart-container h3 {
            margin-bottom: 24px;
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--gray-900);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background-color: var(--white);
            padding: 40px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-xl);
            max-width: 520px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-content h2 {
            margin-bottom: 32px;
            color: var(--gray-900);
            font-size: 1.5rem;
            font-weight: 600;
        }

        .modal-content .form-group {
            margin-bottom: 20px;
        }

        .modal-content .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray-700);
        }

        .modal-content .form-group input,
        .modal-content .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-sm);
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .modal-content .form-group input:focus,
        .modal-content .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 32px;
        }

        .modal-buttons button {
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 500;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .modal-buttons .save-btn {
            background-color: var(--success);
            color: var(--white);
        }

        .modal-buttons .save-btn:hover {
            background-color: #059669;
            transform: translateY(-1px);
        }

        .modal-buttons .cancel-btn {
            background-color: var(--gray-200);
            color: var(--gray-700);
        }

        .modal-buttons .cancel-btn:hover {
            background-color: var(--gray-300);
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 24px;
            left: 50%;
            transform: translateX(-50%);
            padding: 16px 24px;
            border-radius: var(--radius-sm);
            color: var(--white);
            font-weight: 500;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease;
            max-width: 480px;
            text-align: center;
            box-shadow: var(--shadow-lg);
        }

        .notification.show {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(8px);
        }

        .notification.success {
            background: linear-gradient(135deg, var(--success), #22c55e);
        }

        .notification.warning {
            background: linear-gradient(135deg, var(--warning), #fbbf24);
        }

        .notification.danger {
            background: linear-gradient(135deg, var(--danger), #f87171);
        }

        .notification.info {
            background: linear-gradient(135deg, var(--info), #60a5fa);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .form-section form {
                grid-template-columns: 1fr;
            }

            .dashboard-header {
                flex-direction: column;
                gap: 16px;
                align-items: stretch;
            }

            .transaction-item {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }

            .transaction-item .details {
                justify-content: space-between;
            }

            .settings-section .settings-option, .budget-section .budget-form {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }

            .settings-section .settings-option > label {
                min-width: auto;
            }

            .reports-container {
                grid-template-columns: 1fr;
            }

            .chart-container {
                min-width: auto;
            }

            .auth-section {
                padding: 32px 24px;
                margin: 16px;
            }

            .modal-content {
                padding: 32px 24px;
                margin: 16px;
                width: calc(100% - 32px);
            }
        }

        @media (max-width: 480px) {
            .summary-card-container {
                grid-template-columns: 1fr;
            }
            
            .form-section, .budget-section, .transactions-section, .settings-section, .reports-section {
                padding: 24px 20px;
            }
        }
    </style>
</head>
<body>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // PASTE YOUR FIREBASE CONFIG HERE
        // Replace this with your actual Firebase project configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCORUf4_-0cOraupMpCOeDDSz9ErQF8oMw",
    authDomain: "daily-expense-tracker-eff56.firebaseapp.com",
    projectId: "daily-expense-tracker-eff56",
    storageBucket: "daily-expense-tracker-eff56.firebasestorage.app",
    messagingSenderId: "693932204492",
    appId: "1:693932204492:web:82363c870bd2bfc239fd69",
    measurementId: "G-YMMPTCSDTB"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
    </script>

    <div class="container">
        <div class="header">
            <h1>Daily Expense Tracker</h1>
            <p id="auth-status">Track your finances with ease</p>
        </div>

        <div id="login-section" class="auth-section active">
            <h2>Welcome Back</h2>
            <form id="login-form" class="auth-form">
                <input type="email" id="loginEmail" placeholder="Enter your email" required>
                <input type="password" id="loginPassword" placeholder="Enter your password" required>
                <button type="submit">Sign In</button>
            </form>
            <div class="auth-switch">
                <a href="#" id="show-register">Don't have an account? Sign up</a> | 
                <a href="#" id="show-password-recovery">Forgot Password?</a>
            </div>
        </div>

        <div id="register-section" class="auth-section">
            <h2>Create Account</h2>
            <form id="register-form" class="auth-form">
                <input type="email" id="registerEmail" placeholder="Enter your email" required>
                <input type="password" id="registerPassword" placeholder="Create a password" required>
                <button type="submit">Create Account</button>
            </form>
            <div class="auth-switch">
                <a href="#" id="show-login">Already have an account? Sign in</a>
            </div>
        </div>

        <div id="password-recovery-section" class="auth-section">
            <h2>Reset Password</h2>
            <p style="margin-bottom: 16px; color: var(--gray-600);">Enter your email address and we'll send you a password reset link.</p>
            <p class="info-message"><strong>Note:</strong> If you don't receive the reset link in your inbox, please check your spam folder.</p>
            <form id="password-recovery-form" class="auth-form">
                <input type="email" id="recoveryEmail" placeholder="Enter your email" required>
                <button type="submit">Send Reset Link</button>
            </form>
            <div class="auth-switch">
                <a href="#" id="show-login-from-recovery">Back to Sign In</a>
            </div>
        </div>

        <div id="dashboard-section" class="dashboard-section">
            <div class="dashboard-header">
                <h2 id="dashboard-title">Financial Dashboard</h2>
                <button id="signOutButton">Sign Out</button>
            </div>
            
            <div class="summary-card-container">
                <div class="summary-card">
                    <h2>Total Balance</h2>
                    <p id="totalBalance" class="balance">₹0.00</p>
                </div>
                <div class="summary-card income-card">
                    <h2>Total Income</h2>
                    <p id="totalIncome" class="income">₹0.00</p>
                </div>
                <div class="summary-card expense-card">
                    <h2>Total Expenses</h2>
                    <p id="totalExpense" class="expense">₹0.00</p>
                </div>
            </div>

            <div class="budget-section">
                <h2>Monthly Budget</h2>
                <form id="setBudgetForm" class="budget-form">
                    <input type="number" id="budgetAmount" placeholder="Enter monthly budget amount" step="0.01" required>
                    <button type="submit">Set Budget</button>
                </form>
                <div class="budget-progress-container">
                    <div id="budgetProgressBar" class="budget-progress-bar" style="width: 0%;">0%</div>
                </div>
            </div>

            <div class="form-section">
                <h2>Add New Transaction</h2>
                <form id="addTransactionForm">
                    <div class="form-group">
                        <label for="transactionDescription">Description</label>
                        <input type="text" id="transactionDescription" placeholder="e.g., Grocery shopping" required>
                    </div>
                    <div class="form-group">
                        <label for="transactionAmount">Amount</label>
                        <input type="number" id="transactionAmount" placeholder="0.00" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="transactionType">Type</label>
                        <select id="transactionType">
                            <option value="expense">Expense</option>
                            <option value="income">Income</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transactionCategory">Category</label>
                        <select id="transactionCategory"></select>
                    </div>
                    <div class="form-group">
                        <label for="transactionPaymentType">Payment Method</label>
                        <select id="transactionPaymentType">
                            <option value="Credit Card">Credit Card</option>
                            <option value="Debit Card">Debit Card</option>
                            <option value="Digital Wallet">Digital Wallet</option>
                            <option value="UPI" selected>UPI</option>
                            <option value="Cash">Cash</option>
                            <option value="Zelle">Zelle</option>
                            <option value="Bank Transfer">Bank Transfer</option>
                            <option value="Cryptocurrency">Cryptocurrency</option>
                            <option value="BNPL">BNPL</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transactionDate">Date</label>
                        <input type="date" id="transactionDate">
                    </div>
                    <button type="submit">Add Transaction</button>
                </form>
            </div>

            <div class="transactions-section">
                <h2>Recent Transactions</h2>
                <ul id="transactionList">
                    </ul>
                <button id="seeMoreBtn" style="display:none;">Show All Transactions</button>
            </div>

            <div class="reports-section">
                <h2>Financial Reports</h2>
                <div class="reports-container">
                    <div class="chart-container">
                        <h3>Monthly Income vs. Expenses</h3>
                        <canvas id="monthlyChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Expenses by Category</h3>
                        <canvas id="categoryChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Expenses by Payment Method</h3>
                        <canvas id="paymentMethodChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h2>Settings</h2>
                <div class="settings-option">
                    <label for="currency-select">Preferred Currency:</label>
                    <select id="currency-select">
                        <option value="₹">Indian Rupee (₹)</option>
                        <option value="$">US Dollar ($)</option>
                        <option value="€">Euro (€)</option>
                        <option value="£">British Pound (£)</option>
                        <option value="¥">Japanese Yen (¥)</option>
                        <option value="A$">Australian Dollar (A$)</option>
                        <option value="C$">Canadian Dollar (C$)</option>
                        <option value="Fr">Swiss Franc (Fr)</option>
                        <option value="R">South African Rand (R)</option>
                        <option value="₩">South Korean Won (₩)</option>
                        <option value="Mex$">Mexican Peso (Mex$)</option>
                        <option value="R$">Brazilian Real (R$)</option>
                        <option value="₽">Russian Ruble (₽)</option>
                        <option value="kr">Swedish Krona (kr)</option>
                        <option value="zł">Polish Złoty (zł)</option>
                        <option value="DKK">Danish Krone (DKK)</option>
                        <option value="د.إ">UAE Dirham (د.إ)</option>
                        <option value="SGD">Singapore Dollar (SGD)</option>
                        <option value="HK$">Hong Kong Dollar (HK$)</option>
                        <option value="₺">Turkish Lira (₺)</option>
                    </select>
                </div>
                <div class="settings-option">
                    <label>Add New Category:</label>
                    <input type="text" id="newCategoryInput" placeholder="e.g., Groceries, Entertainment">
                    <button id="addCategoryButton">Add Category</button>
                </div>
                <div class="settings-option">
                    <label>Remove Category:</label>
                    <select id="removeCategorySelect"></select>
                    <button id="removeCategoryButton" style="background-color: var(--danger);">Remove Category</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="notification" class="notification"></div>
    
    <div id="editModal" class="modal-overlay">
        <div class="modal-content">
            <h2>Edit Transaction</h2>
            <form id="editTransactionForm">
                <input type="hidden" id="editTransactionId">
                <div class="form-group">
                    <label for="editDescription">Description</label>
                    <input type="text" id="editDescription" required>
                </div>
                <div class="form-group">
                    <label for="editAmount">Amount</label>
                    <input type="number" id="editAmount" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="editType">Type</label>
                    <select id="editType">
                        <option value="expense">Expense</option>
                        <option value="income">Income</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editCategory">Category</label>
                    <select id="editCategory"></select>
                </div>
                <div class="form-group">
                    <label for="editPaymentType">Payment Method</label>
                    <select id="editPaymentType">
                        <option value="Credit Card">Credit Card</option>
                        <option value="Debit Card">Debit Card</option>
                        <option value="Digital Wallet">Digital Wallet</option>
                        <option value="UPI">UPI</option>
                        <option value="Cash">Cash</option>
                        <option value="Zelle">Zelle</option>
                        <option value="Bank Transfer">Bank Transfer</option>
                        <option value="Cryptocurrency">Cryptocurrency</option>
                        <option value="BNPL">BNPL</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editDate">Date</label>
                    <input type="date" id="editDate">
                </div>
                <div class="modal-buttons">
                    <button type="button" id="cancelEditBtn" class="cancel-btn">Cancel</button>
                    <button type="submit" class="save-btn">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const addTransactionForm = document.getElementById('addTransactionForm');
        const setBudgetForm = document.getElementById('setBudgetForm');
        const passwordRecoveryForm = document.getElementById('password-recovery-form');
        const loginSection = document.getElementById('login-section');
        const registerSection = document.getElementById('register-section');
        const passwordRecoverySection = document.getElementById('password-recovery-section');
        const dashboardSection = document.getElementById('dashboard-section');
        const showRegisterBtn = document.getElementById('show-register');
        const showLoginBtn = document.getElementById('show-login');
        const showPasswordRecoveryBtn = document.getElementById('show-password-recovery');
        const showLoginFromRecoveryBtn = document.getElementById('show-login-from-recovery');
        const signOutButton = document.getElementById('signOutButton');
        const authStatus = document.getElementById('auth-status');
        const totalBalanceEl = document.getElementById('totalBalance');
        const totalIncomeEl = document.getElementById('totalIncome');
        const totalExpenseEl = document.getElementById('totalExpense');
        const transactionList = document.getElementById('transactionList');
        const budgetAmountInput = document.getElementById('budgetAmount');
        const budgetProgressBar = document.getElementById('budgetProgressBar');
        const currencySelect = document.getElementById('currency-select');
        const newCategoryInput = document.getElementById('newCategoryInput');
        const addCategoryButton = document.getElementById('addCategoryButton');
        const removeCategorySelect = document.getElementById('removeCategorySelect');
        const removeCategoryButton = document.getElementById('removeCategoryButton');
        const transactionCategorySelect = document.getElementById('transactionCategory');
        const seeMoreBtn = document.getElementById('seeMoreBtn');
        const monthlyChartCanvas = document.getElementById('monthlyChart');
        const categoryChartCanvas = document.getElementById('categoryChart');
        const paymentMethodChartCanvas = document.getElementById('paymentMethodChart');
        const transactionPaymentTypeSelect = document.getElementById('transactionPaymentType');

        const editModal = document.getElementById('editModal');
        const editTransactionForm = document.getElementById('editTransactionForm');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        const editTransactionIdInput = document.getElementById('editTransactionId');
        const editDescriptionInput = document.getElementById('editDescription');
        const editAmountInput = document.getElementById('editAmount');
        const editTypeSelect = document.getElementById('editType');
        const editCategorySelect = document.getElementById('editCategory');
        const editPaymentTypeSelect = document.getElementById('editPaymentType');
        const editDateInput = document.getElementById('editDate');

        const defaultCategories = ['Food', 'Transport', 'Utilities', 'Shopping', 'Salary'];

        let monthlyBudget = 0;
        let currencySymbol = '₹';
        let monthlyChart = null;
        let categoryChart = null;
        let paymentMethodChart = null;

        const userDataRef = (uid) => db.collection('users').doc(uid);

        async function saveUserData(data) {
            if (auth.currentUser) {
                await userDataRef(auth.currentUser.uid).set(data, { merge: true });
            }
        }

        async function loadUserData() {
            if (auth.currentUser) {
                const doc = await userDataRef(auth.currentUser.uid).get();
                return doc.exists ? doc.data() : null;
            }
            return null;
        }

        function renderAuthView(view = 'login') {
            loginSection.style.display = 'none';
            registerSection.style.display = 'none';
            passwordRecoverySection.style.display = 'none';
            dashboardSection.style.display = 'none';

            if (view === 'login') {
                loginSection.style.display = 'block';
            } else if (view === 'register') {
                registerSection.style.display = 'block';
            } else if (view === 'password-recovery') {
                passwordRecoverySection.style.display = 'block';
            }
        }

        async function renderDashboard() {
            if (auth.currentUser) {
                loginSection.style.display = 'none';
                registerSection.style.display = 'none';
                passwordRecoverySection.style.display = 'none';
                dashboardSection.style.display = 'block';
                authStatus.textContent = `Welcome, ${auth.currentUser.email}!`;
                await loadSettings();
                await renderTransactionList();
                updateSummary();
                await renderReports();
            } else {
                dashboardSection.style.display = 'none';
                renderAuthView('login');
                authStatus.textContent = 'Track your finances with ease';
            }
        }

        auth.onAuthStateChanged(user => {
            renderDashboard();
        });

        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = e.target.registerEmail.value;
            const password = e.target.registerPassword.value;
            
            try {
                await auth.createUserWithEmailAndPassword(email, password);
                showNotification('Account created successfully! Please sign in.', 'success');
                renderAuthView('login');
            } catch (error) {
                showNotification(`Error: ${error.message}`, 'danger');
            }
        });

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = e.target.loginEmail.value;
            const password = e.target.loginPassword.value;
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                showNotification('Welcome back!', 'success');
            } catch (error) {
                showNotification(`Error: ${error.message}`, 'danger');
            }
        });

        passwordRecoveryForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = e.target.recoveryEmail.value;
            
            try {
                await auth.sendPasswordResetEmail(email);
                showNotification('Password reset email sent! Check your inbox.', 'success');
                renderAuthView('login');
            } catch (error) {
                showNotification(`Error: ${error.message}`, 'danger');
            }
        });

        signOutButton.addEventListener('click', async () => {
            try {
                await auth.signOut();
                showNotification('Signed out successfully!', 'info');
            } catch (error) {
                showNotification(`Error: ${error.message}`, 'danger');
            }
        });

        setBudgetForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const budget = parseFloat(e.target.budgetAmount.value);
            if (isNaN(budget) || budget <= 0) {
                showNotification('Please enter a valid budget amount.', 'danger');
                return;
            }
            monthlyBudget = budget;
            await saveUserData({ budget: monthlyBudget });
            showNotification('Budget updated successfully!', 'success');
            updateSummary();
        });

        addCategoryButton.addEventListener('click', async () => {
            const newCategory = newCategoryInput.value.trim();
            if (newCategory) {
                const userData = await loadUserData();
                const userCategories = userData?.categories || [];
                const allCategories = [...defaultCategories, ...userCategories];
                
                if (!allCategories.includes(newCategory)) {
                    userCategories.push(newCategory);
                    await saveUserData({ categories: userCategories });
                    newCategoryInput.value = '';
                    renderCategories(userCategories);
                    showNotification('Category added successfully!', 'success');
                } else {
                    showNotification('Category already exists.', 'warning');
                }
            }
        });
        
        removeCategoryButton.addEventListener('click', async () => {
            const categoryToRemove = removeCategorySelect.value;
            const userData = await loadUserData();
            let userCategories = userData?.categories || [];

            if (defaultCategories.includes(categoryToRemove)) {
                showNotification('You cannot remove a default category.', 'danger');
                return;
            }
            
            userCategories = userCategories.filter(cat => cat !== categoryToRemove);
            await saveUserData({ categories: userCategories });
            renderCategories(userCategories);
            showNotification('Category removed successfully!', 'success');
        });

        currencySelect.addEventListener('change', async (e) => {
            currencySymbol = e.target.value;
            await saveUserData({ currency: currencySymbol });
            updateSummary();
            renderTransactionList();
            showNotification('Currency updated!', 'success');
        });

        addTransactionForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const description = e.target.transactionDescription.value;
            const amount = parseFloat(e.target.transactionAmount.value);
            const type = e.target.transactionType.value;
            const category = e.target.transactionCategory.value;
            const paymentType = e.target.transactionPaymentType.value;
            const date = e.target.transactionDate.value || new Date().toISOString().substring(0, 10);

            if (isNaN(amount) || amount <= 0) {
                showNotification('Please enter a valid amount.', 'danger');
                return;
            }

            const transactions = (await loadUserData())?.transactions || [];
            const newTransaction = {
                id: Date.now(),
                description,
                amount,
                type,
                category,
                paymentType,
                date: new Date(date).toISOString()
            };
            transactions.push(newTransaction);
            await saveUserData({ transactions });

            showNotification('Transaction added successfully!', 'success');
            e.target.reset();
            updateSummary();
            await renderTransactionList();
            await renderReports();
        });

        async function renderTransactionList(showAll = false) {
            transactionList.innerHTML = '';
            const allTransactions = (await loadUserData())?.transactions || [];
            allTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            let transactionsToDisplay;
            if (showAll) {
                transactionsToDisplay = allTransactions;
                seeMoreBtn.style.display = 'none';
            } else {
                transactionsToDisplay = allTransactions.slice(0, 5);
                if (allTransactions.length > 5) {
                    seeMoreBtn.style.display = 'block';
                } else {
                    seeMoreBtn.style.display = 'none';
                }
            }

            if (transactionsToDisplay.length === 0) {
                const emptyMessage = document.createElement('li');
                emptyMessage.style.textAlign = 'center';
                emptyMessage.style.color = 'var(--gray-500)';
                emptyMessage.style.padding = '40px 20px';
                emptyMessage.innerHTML = 'No transactions yet. Add your first transaction above!';
                transactionList.appendChild(emptyMessage);
                return;
            }

            transactionsToDisplay.forEach(transaction => {
                const listItem = document.createElement('li');
                listItem.className = 'transaction-item';
                const amountClass = transaction.type === 'expense' ? 'expense-amount' : 'income-amount';
                listItem.innerHTML = `
                    <span class="description">${transaction.description} (${transaction.category} - ${transaction.paymentType})</span>
                    <div class="details">
                        <span class="amount ${amountClass}">${currencySymbol}${transaction.amount.toFixed(2)}</span>
                        <span class="date">${new Date(transaction.date).toLocaleDateString()}</span>
                        <div class="action-buttons">
                            <button class="edit-btn" onclick="editTransaction(${transaction.id})">Edit</button>
                            <button class="delete-btn" onclick="deleteTransaction(${transaction.id})">&times;</button>
                        </div>
                    </div>
                `;
                transactionList.appendChild(listItem);
            });
        }

        seeMoreBtn.addEventListener('click', () => {
            renderTransactionList(true);
        });

        async function editTransaction(id) {
            const userData = await loadUserData();
            const transaction = userData.transactions.find(t => t.id === id);
            if (transaction) {
                editTransactionIdInput.value = transaction.id;
                editDescriptionInput.value = transaction.description;
                editAmountInput.value = transaction.amount;
                editTypeSelect.value = transaction.type;
                editPaymentTypeSelect.value = transaction.paymentType;
                editDateInput.value = new Date(transaction.date).toISOString().substring(0, 10);
                
                // Set the category options for the edit form
                renderCategories(userData.categories, editCategorySelect);
                editCategorySelect.value = transaction.category;

                editModal.style.display = 'flex';
            }
        }

        cancelEditBtn.addEventListener('click', () => {
            editModal.style.display = 'none';
        });

        editTransactionForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = parseInt(editTransactionIdInput.value);
            const description = editDescriptionInput.value;
            const amount = parseFloat(editAmountInput.value);
            const type = editTypeSelect.value;
            const category = editCategorySelect.value;
            const paymentType = editPaymentTypeSelect.value;
            const date = editDateInput.value;

            if (isNaN(amount) || amount <= 0) {
                showNotification('Please enter a valid amount.', 'danger');
                return;
            }

            const userData = await loadUserData();
            const transactions = userData.transactions.map(t => {
                if (t.id === id) {
                    return {
                        ...t,
                        description,
                        amount,
                        type,
                        category,
                        paymentType,
                        date: new Date(date).toISOString()
                    };
                }
                return t;
            });
            await saveUserData({ transactions });
            
            showNotification('Transaction updated successfully!', 'success');
            editModal.style.display = 'none';
            updateSummary();
            await renderTransactionList();
            await renderReports();
        });

        async function deleteTransaction(id) {
            let transactions = (await loadUserData())?.transactions || [];
            transactions = transactions.filter(transaction => transaction.id !== id);
            await saveUserData({ transactions });
            showNotification('Transaction deleted!', 'info');
            updateSummary();
            await renderTransactionList();
            await renderReports();
        }

        async function updateSummary() {
            const transactions = (await loadUserData())?.transactions || [];
            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);

            const totalExpense = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);

            const totalBalance = totalIncome - totalExpense;

            totalBalanceEl.textContent = `${currencySymbol}${totalBalance.toFixed(2)}`;
            totalIncomeEl.textContent = `${currencySymbol}${totalIncome.toFixed(2)}`;
            totalExpenseEl.textContent = `${currencySymbol}${totalExpense.toFixed(2)}`;

            totalBalanceEl.style.color = totalBalance >= 0 ? 'var(--primary)' : 'var(--danger)';

            updateBudgetProgress(totalExpense);
        }

        function updateBudgetProgress(totalExpense) {
            if (monthlyBudget > 0) {
                const monthlyProgress = (totalExpense / monthlyBudget) * 100;
                budgetProgressBar.style.width = `${Math.min(monthlyProgress, 100)}%`;
                budgetProgressBar.textContent = `${Math.round(monthlyProgress)}%`;

                if (monthlyProgress >= 100) {
                    budgetProgressBar.style.background = 'linear-gradient(90deg, var(--danger), #f87171)';
                    showNotification(`Budget exceeded! You have spent ${currencySymbol}${totalExpense.toFixed(2)} this month.`, 'danger');
                } else if (monthlyProgress >= 90) {
                    budgetProgressBar.style.background = 'linear-gradient(90deg, var(--warning), #fbbf24)';
                    showNotification('You have used 90% of your monthly budget!', 'warning');
                } else if (monthlyProgress >= 80) {
                    budgetProgressBar.style.background = 'linear-gradient(90deg, var(--warning), #fbbf24)';
                    showNotification('You have used 80% of your monthly budget. Consider reducing expenses.', 'warning');
                } else {
                    budgetProgressBar.style.background = 'linear-gradient(90deg, var(--success), #22c55e)';
                }
            } else {
                budgetProgressBar.style.width = '0%';
                budgetProgressBar.textContent = 'Set a budget';
                budgetProgressBar.style.background = 'var(--gray-300)';
            }
        }

        async function loadSettings() {
            const userData = await loadUserData();
            if (userData) {
                if (userData.budget) {
                    monthlyBudget = userData.budget;
                    budgetAmountInput.value = monthlyBudget > 0 ? monthlyBudget : '';
                }
                if (userData.currency) {
                    currencySymbol = userData.currency;
                    currencySelect.value = currencySymbol;
                }
                renderCategories(userData.categories);
            }
        }

        function renderCategories(userCategories = [], selectElement = null) {
            const allCategories = [...defaultCategories, ...userCategories];
            
            // Clear and populate the 'Add Transaction' and 'Edit Transaction' category dropdowns
            if (!selectElement) {
                transactionCategorySelect.innerHTML = '';
                editCategorySelect.innerHTML = '';
                allCategories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    transactionCategorySelect.appendChild(option);

                    const editOption = option.cloneNode(true);
                    editCategorySelect.appendChild(editOption);
                });
            } else {
                selectElement.innerHTML = '';
                allCategories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    selectElement.appendChild(option);
                });
            }

            // Clear and populate the 'Remove Category' dropdown with custom categories only
            removeCategorySelect.innerHTML = '';
            if (userCategories.length === 0) {
                const option = document.createElement('option');
                option.textContent = 'No custom categories';
                option.disabled = true;
                removeCategorySelect.appendChild(option);
            } else {
                userCategories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    removeCategorySelect.appendChild(option);
                });
            }
        }

        async function renderReports() {
            const transactions = (await loadUserData())?.transactions || [];

            // Group transactions by month and year
            const monthlyData = {};
            const categoryData = {};
            const paymentMethodData = {};

            transactions.forEach(t => {
                const date = new Date(t.date);
                const monthYear = `${date.toLocaleString('default', { month: 'short' })} ${date.getFullYear()}`;
                
                if (!monthlyData[monthYear]) {
                    monthlyData[monthYear] = { income: 0, expense: 0 };
                }

                if (t.type === 'income') {
                    monthlyData[monthYear].income += t.amount;
                } else {
                    monthlyData[monthYear].expense += t.amount;
                    if (!categoryData[t.category]) {
                        categoryData[t.category] = 0;
                    }
                    categoryData[t.category] += t.amount;
                    
                    if (!paymentMethodData[t.paymentType]) {
                        paymentMethodData[t.paymentType] = 0;
                    }
                    paymentMethodData[t.paymentType] += t.amount;
                }
            });

            // Create data for monthly chart
            const monthlyLabels = Object.keys(monthlyData).sort((a, b) => new Date(a) - new Date(b));
            const monthlyIncome = monthlyLabels.map(label => monthlyData[label].income);
            const monthlyExpenses = monthlyLabels.map(label => monthlyData[label].expense);
            
            // Create data for category chart
            const categoryLabels = Object.keys(categoryData);
            const categoryExpenses = Object.values(categoryData);

            // Create data for payment method chart
            const paymentMethodLabels = Object.keys(paymentMethodData);
            const paymentMethodExpenses = Object.values(paymentMethodData);

            // Render monthly chart
            if (monthlyChart) monthlyChart.destroy();
            monthlyChart = new Chart(monthlyChartCanvas, {
                type: 'bar',
                data: {
                    labels: monthlyLabels,
                    datasets: [{
                        label: 'Income',
                        data: monthlyIncome,
                        backgroundColor: 'rgba(16, 185, 129, 0.8)',
                        borderColor: '#10b981',
                        borderWidth: 1
                    }, {
                        label: 'Expenses',
                        data: monthlyExpenses,
                        backgroundColor: 'rgba(239, 68, 68, 0.8)',
                        borderColor: '#ef4444',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });

            // Render category chart
            if (categoryChart) categoryChart.destroy();
            const categoryColors = [
                '#6366f1', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6',
                '#06b6d4', '#84cc16', '#f97316', '#ec4899', '#14b8a6'
            ];
            categoryChart = new Chart(categoryChartCanvas, {
                type: 'pie',
                data: {
                    labels: categoryLabels,
                    datasets: [{
                        data: categoryExpenses,
                        backgroundColor: categoryColors.slice(0, categoryLabels.length),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        }
                    }
                }
            });

            // Render payment method chart
            if (paymentMethodChart) paymentMethodChart.destroy();
            paymentMethodChart = new Chart(paymentMethodChartCanvas, {
                type: 'doughnut',
                data: {
                    labels: paymentMethodLabels,
                    datasets: [{
                        data: paymentMethodExpenses,
                        backgroundColor: categoryColors.slice(0, paymentMethodLabels.length),
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                        }
                    }
                }
            });
        }

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }
        
        showRegisterBtn.addEventListener('click', (e) => {
            e.preventDefault();
            renderAuthView('register');
        });

        showLoginBtn.addEventListener('click', (e) => {
            e.preventDefault();
            renderAuthView('login');
        });
        
        showPasswordRecoveryBtn.addEventListener('click', (e) => {
            e.preventDefault();
            renderAuthView('password-recovery');
        });

        showLoginFromRecoveryBtn.addEventListener('click', (e) => {
            e.preventDefault();
            renderAuthView('login');
        });

        // Set today's date as default for transaction date
        document.getElementById('transactionDate').valueAsDate = new Date();

        // Close modal when clicking outside
        editModal.addEventListener('click', (e) => {
            if (e.target === editModal) {
                editModal.style.display = 'none';
            }
        });

        // Initialize the app
        renderCategories();
    </script>
</body>
</html>
