<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Expense Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .auth-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            text-align: center;
            margin-top: 50px;
            display: none;
        }

        .auth-section.active {
            display: block;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .auth-form input {
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            width: 100%;
        }

        .auth-form button {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            color: white;
            background: #764ba2;
            transition: background 0.3s;
        }

        .auth-form button:hover {
            background: #667eea;
        }

        .auth-switch {
            margin-top: 15px;
            font-size: 0.9em;
        }

        .auth-switch a {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s;
        }

        .auth-switch a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .dashboard-header button {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            color: white;
            background: #dc3545;
            transition: background 0.3s;
        }

        .dashboard-header button:hover {
            background: #c82333;
        }
        
        .dashboard-section {
            display: none;
        }

        .summary-card-container {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            flex: 1;
            min-width: 250px;
        }

        .summary-card h2 {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #764ba2;
        }

        .summary-card p {
            font-size: 1.5em;
            font-weight: bold;
        }

        .summary-card .income { color: #28a745; }
        .summary-card .expense { color: #dc3545; }
        .summary-card .balance { color: #007bff; }

        .form-section, .budget-section, .transactions-section, .settings-section, .reports-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .form-section h2, .budget-section h2, .transactions-section h2, .settings-section h2, .reports-section h2 {
            margin-bottom: 20px;
            color: #764ba2;
        }

        .form-section form {
            display: grid;
            gap: 15px;
            grid-template-columns: repeat(5, 1fr) auto;
        }
        
        .settings-section .settings-option, .budget-section .budget-form {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .settings-section .settings-option select,
        .settings-section .settings-option input,
        .budget-section .budget-form input {
            flex-grow: 1;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 0.9em;
            color: #555;
            margin-bottom: 5px;
        }

        .form-section input, .form-section select, .form-section button,
        .budget-section input, .budget-section button,
        .settings-section input, .settings-section select, .settings-section button {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
        }

        .form-section button, .budget-section button, .settings-section button {
            background: #764ba2;
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }

        .form-section button:hover, .budget-section button:hover, .settings-section button:hover {
            background: #667eea;
        }

        .transactions-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        #transactionList {
            list-style: none;
            padding: 0;
            margin-top: 15px;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-item .description {
            font-weight: bold;
            color: #333;
        }

        .transaction-item .details {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .transaction-item .amount {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 5px;
        }

        .transaction-item .expense-amount {
            color: white;
            background-color: #dc3545;
        }

        .transaction-item .income-amount {
            color: white;
            background-color: #28a745;
        }

        .transaction-item .date {
            font-size: 0.8em;
            color: #777;
        }

        .transaction-item .action-buttons {
            display: flex;
            gap: 8px;
        }

        .transaction-item .action-buttons .edit-btn,
        .transaction-item .action-buttons .delete-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            padding: 5px;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .transaction-item .action-buttons .edit-btn {
            color: #007bff;
        }

        .transaction-item .action-buttons .edit-btn:hover {
            background-color: #e9f5ff;
        }

        .transaction-item .action-buttons .delete-btn {
            color: #dc3545;
        }

        .transaction-item .action-buttons .delete-btn:hover {
            background-color: #fcebeb;
        }


        .budget-progress-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 20px;
            margin-top: 15px;
            overflow: hidden;
        }

        .budget-progress-bar {
            height: 25px;
            background-color: #28a745;
            text-align: center;
            line-height: 25px;
            color: white;
            transition: width 0.4s ease;
        }

        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
        }

        .notification.show {
            opacity: 1;
            visibility: visible;
        }

        .notification.success {
            background-color: #28a745;
        }

        .notification.warning {
            background-color: #ffc107;
        }

        .notification.danger {
            background-color: #dc3545;
        }

        .notification.info {
            background-color: #17a2b8;
        }
        
        .reports-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        
        .chart-container {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            flex: 1;
            min-width: 300px;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1001;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            max-width: 500px;
            width: 90%;
        }
        
        .modal-content h2 {
            margin-bottom: 20px;
            color: #764ba2;
        }

        .modal-content .form-group {
            margin-bottom: 15px;
        }

        .modal-content .form-group label {
            display: block;
            margin-bottom: 5px;
        }

        .modal-content .form-group input,
        .modal-content .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .modal-buttons .save-btn {
            background-color: #28a745;
            color: white;
        }

        .modal-buttons .cancel-btn {
            background-color: #f1f1f1;
            color: #333;
        }

        @media (max-width: 768px) {
            .form-section form {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // PASTE YOUR FIREBASE CONFIG HERE
        // Replace this with your actual Firebase project configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCORUf4_-0cOraupMpCOeDDSz9ErQF8oMw",
    authDomain: "daily-expense-tracker-eff56.firebaseapp.com",
    projectId: "daily-expense-tracker-eff56",
    storageBucket: "daily-expense-tracker-eff56.firebasestorage.app",
    messagingSenderId: "693932204492",
    appId: "1:693932204492:web:82363c870bd2bfc239fd69",
    measurementId: "G-YMMPTCSDTB"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
    </script>

    <div class="container">
        <div class="header">
            <h1>Daily Expense Tracker</h1>
            <p id="auth-status">Welcome!</p>
        </div>

        <div id="login-section" class="auth-section active">
            <h2>Login</h2>
            <form id="login-form" class="auth-form">
                <input type="email" id="loginEmail" placeholder="Email" required>
                <input type="password" id="loginPassword" placeholder="Password" required>
                <button type="submit">Log In</button>
            </form>
            <div class="auth-switch">
                <a href="#" id="show-register">Don't have an account? Register here</a>
            </div>
        </div>

        <div id="register-section" class="auth-section">
            <h2>Register</h2>
            <form id="register-form" class="auth-form">
                <input type="email" id="registerEmail" placeholder="Email" required>
                <input type="password" id="registerPassword" placeholder="Password" required>
                <button type="submit">Register</button>
            </form>
            <div class="auth-switch">
                <a href="#" id="show-login">Already have an account? Log In</a>
            </div>
        </div>

        <div id="dashboard-section" class="dashboard-section">
            <div class="dashboard-header">
                <h2 id="dashboard-title">Dashboard</h2>
                <button id="signOutButton">Sign Out</button>
            </div>
            
            <div class="summary-card-container">
                <div class="summary-card">
                    <h2>Total Balance</h2>
                    <p id="totalBalance" class="balance">₹0.00</p>
                </div>
                <div class="summary-card">
                    <h2>Total Income</h2>
                    <p id="totalIncome" class="income">₹0.00</p>
                </div>
                <div class="summary-card">
                    <h2>Total Expenses</h2>
                    <p id="totalExpense" class="expense">₹0.00</p>
                </div>
            </div>

            <div class="budget-section">
                <h2>Monthly Budget</h2>
                <form id="setBudgetForm" class="budget-form">
                    <input type="number" id="budgetAmount" placeholder="Enter monthly budget" step="0.01" required>
                    <button type="submit">Set Budget</button>
                </form>
                <div class="budget-progress-container">
                    <div id="budgetProgressBar" class="budget-progress-bar" style="width: 0%;">0%</div>
                </div>
            </div>

            <div class="form-section">
                <h2>Add New Transaction</h2>
                <form id="addTransactionForm">
                    <div class="form-group">
                        <label for="transactionDescription">Description</label>
                        <input type="text" id="transactionDescription" required>
                    </div>
                    <div class="form-group">
                        <label for="transactionAmount">Amount</label>
                        <input type="number" id="transactionAmount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="transactionType">Type</label>
                        <select id="transactionType">
                            <option value="expense">Expense</option>
                            <option value="income">Income</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transactionCategory">Category</label>
                        <select id="transactionCategory"></select>
                    </div>
                    <div class="form-group">
                        <label for="transactionPaymentType">Payment Method</label>
                        <select id="transactionPaymentType">
                            <option value="Credit Card">Credit Card</option>
                            <option value="Debit Card">Debit Card</option>
                            <option value="Digital Wallet">Digital Wallet</option>
                            <option value="UPI" selected>UPI</option>
                            <option value="Zelle">Zelle</option>
                            <option value="Bank Transfer">Bank Transfer</option>
                            <option value="Cryptocurrency">Cryptocurrency</option>
                            <option value="BNPL">BNPL</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="transactionDate">Date</label>
                        <input type="date" id="transactionDate">
                    </div>
                    <button type="submit">Add Transaction</button>
                </form>
            </div>

            <div class="transactions-section">
                <h2>Transactions</h2>
                <ul id="transactionList">
                    </ul>
                <button id="seeMoreBtn" style="display:none; margin-top: 10px; width: 100%; padding: 10px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">See More</button>
            </div>

            <div class="reports-section">
                <h2>Reports</h2>
                <div class="reports-container">
                    <div class="chart-container">
                        <h3>Monthly Income vs. Expenses</h3>
                        <canvas id="monthlyChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Expenses by Category</h3>
                        <canvas id="categoryChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>Expenses by Payment Method</h3>
                        <canvas id="paymentMethodChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h2>Settings</h2>
                <div class="settings-option">
                    <label for="currency-select">Preferred Currency:</label>
                    <select id="currency-select">
                        <option value="₹">Indian Rupee (₹)</option>
                        <option value="$">US Dollar ($)</option>
                        <option value="€">Euro (€)</option>
                        <option value="£">British Pound (£)</option>
                        <option value="¥">Japanese Yen (¥)</option>
                        <option value="A$">Australian Dollar (A$)</option>
                        <option value="C$">Canadian Dollar (C$)</option>
                        <option value="Fr">Swiss Franc (Fr)</option>
                        <option value="R">South African Rand (R)</option>
                        <option value="₩">South Korean Won (₩)</option>
                        <option value="Mex$">Mexican Peso (Mex$)</option>
                        <option value="R$">Brazilian Real (R$)</option>
                        <option value="₽">Russian Ruble (₽)</option>
                        <option value="kr">Swedish Krona (kr)</option>
                        <option value="zł">Polish Złoty (zł)</option>
                        <option value="DKK">Danish Krone (DKK)</option>
                        <option value="د.إ">UAE Dirham (د.إ)</option>
                        <option value="SGD">Singapore Dollar (SGD)</option>
                        <option value="HK$">Hong Kong Dollar (HK$)</option>
                        <option value="₺">Turkish Lira (₺)</option>
                    </select>
                </div>
                <div class="settings-option" style="margin-top: 20px;">
                    <label>Add New Category:</label>
                    <input type="text" id="newCategoryInput" placeholder="e.g., Groceries">
                    <button id="addCategoryButton">Add Category</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="notification" class="notification"></div>
    
    <div id="editModal" class="modal-overlay">
        <div class="modal-content">
            <h2>Edit Transaction</h2>
            <form id="editTransactionForm">
                <input type="hidden" id="editTransactionId">
                <div class="form-group">
                    <label for="editDescription">Description</label>
                    <input type="text" id="editDescription" required>
                </div>
                <div class="form-group">
                    <label for="editAmount">Amount</label>
                    <input type="number" id="editAmount" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="editType">Type</label>
                    <select id="editType">
                        <option value="expense">Expense</option>
                        <option value="income">Income</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editCategory">Category</label>
                    <select id="editCategory"></select>
                </div>
                <div class="form-group">
                    <label for="editPaymentType">Payment Method</label>
                    <select id="editPaymentType">
                        <option value="Credit Card">Credit Card</option>
                        <option value="Debit Card">Debit Card</option>
                        <option value="Digital Wallet">Digital Wallet</option>
                        <option value="UPI">UPI</option>
                        <option value="Zelle">Zelle</option>
                        <option value="Bank Transfer">Bank Transfer</option>
                        <option value="Cryptocurrency">Cryptocurrency</option>
                        <option value="BNPL">BNPL</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editDate">Date</label>
                    <input type="date" id="editDate">
                </div>
                <div class="modal-buttons">
                    <button type="button" id="cancelEditBtn" class="cancel-btn">Cancel</button>
                    <button type="submit" class="save-btn">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const addTransactionForm = document.getElementById('addTransactionForm');
        const setBudgetForm = document.getElementById('setBudgetForm');
        const loginSection = document.getElementById('login-section');
        const registerSection = document.getElementById('register-section');
        const dashboardSection = document.getElementById('dashboard-section');
        const showRegisterBtn = document.getElementById('show-register');
        const showLoginBtn = document.getElementById('show-login');
        const signOutButton = document.getElementById('signOutButton');
        const authStatus = document.getElementById('auth-status');
        const totalBalanceEl = document.getElementById('totalBalance');
        const totalIncomeEl = document.getElementById('totalIncome');
        const totalExpenseEl = document.getElementById('totalExpense');
        const transactionList = document.getElementById('transactionList');
        const budgetAmountInput = document.getElementById('budgetAmount');
        const budgetProgressBar = document.getElementById('budgetProgressBar');
        const currencySelect = document.getElementById('currency-select');
        const newCategoryInput = document.getElementById('newCategoryInput');
        const addCategoryButton = document.getElementById('addCategoryButton');
        const transactionCategorySelect = document.getElementById('transactionCategory');
        const seeMoreBtn = document.getElementById('seeMoreBtn');
        const monthlyChartCanvas = document.getElementById('monthlyChart');
        const categoryChartCanvas = document.getElementById('categoryChart');
        const paymentMethodChartCanvas = document.getElementById('paymentMethodChart');
        const transactionPaymentTypeSelect = document.getElementById('transactionPaymentType');

        const editModal = document.getElementById('editModal');
        const editTransactionForm = document.getElementById('editTransactionForm');
        const cancelEditBtn = document.getElementById('cancelEditBtn');
        const editTransactionIdInput = document.getElementById('editTransactionId');
        const editDescriptionInput = document.getElementById('editDescription');
        const editAmountInput = document.getElementById('editAmount');
        const editTypeSelect = document.getElementById('editType');
        const editCategorySelect = document.getElementById('editCategory');
        const editPaymentTypeSelect = document.getElementById('editPaymentType');
        const editDateInput = document.getElementById('editDate');

        const defaultCategories = ['Food', 'Transport', 'Utilities', 'Shopping', 'Salary'];

        let monthlyBudget = 0;
        let currencySymbol = '₹';
        let monthlyChart = null;
        let categoryChart = null;
        let paymentMethodChart = null;

        const userDataRef = (uid) => db.collection('users').doc(uid);

        async function saveUserData(data) {
            if (auth.currentUser) {
                await userDataRef(auth.currentUser.uid).set(data, { merge: true });
            }
        }

        async function loadUserData() {
            if (auth.currentUser) {
                const doc = await userDataRef(auth.currentUser.uid).get();
                return doc.exists ? doc.data() : null;
            }
            return null;
        }

        function renderAuthView(view = 'login') {
            loginSection.style.display = 'none';
            registerSection.style.display = 'none';
            dashboardSection.style.display = 'none';

            if (view === 'login') {
                loginSection.style.display = 'block';
            } else if (view === 'register') {
                registerSection.style.display = 'block';
            }
        }

        async function renderDashboard() {
            if (auth.currentUser) {
                loginSection.style.display = 'none';
                registerSection.style.display = 'none';
                dashboardSection.style.display = 'block';
                authStatus.textContent = `Welcome, ${auth.currentUser.email}!`;
                await loadSettings();
                await renderTransactionList();
                updateSummary();
                await renderReports();
            } else {
                dashboardSection.style.display = 'none';
                renderAuthView('login');
                authStatus.textContent = `Welcome!`;
            }
        }

        auth.onAuthStateChanged(user => {
            renderDashboard();
        });

        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = e.target.registerEmail.value;
            const password = e.target.registerPassword.value;
            
            try {
                await auth.createUserWithEmailAndPassword(email, password);
                showNotification('Registration successful! Please log in.', 'success');
                renderAuthView('login');
            } catch (error) {
                showNotification(`Error: ${error.message}`, 'danger');
            }
        });

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = e.target.loginEmail.value;
            const password = e.target.loginPassword.value;
            
            try {
                await auth.signInWithEmailAndPassword(email, password);
                showNotification('Login successful!', 'success');
            } catch (error) {
                showNotification(`Error: ${error.message}`, 'danger');
            }
        });

        signOutButton.addEventListener('click', async () => {
            try {
                await auth.signOut();
                showNotification('Signed out successfully!', 'info');
            } catch (error) {
                showNotification(`Error: ${error.message}`, 'danger');
            }
        });

        setBudgetForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const budget = parseFloat(e.target.budgetAmount.value);
            if (isNaN(budget) || budget <= 0) {
                showNotification('Please enter a valid budget amount.', 'danger');
                return;
            }
            monthlyBudget = budget;
            await saveUserData({ budget: monthlyBudget });
            showNotification('Budget updated successfully!', 'success');
            updateSummary();
        });

        addCategoryButton.addEventListener('click', async () => {
            const newCategory = newCategoryInput.value.trim();
            if (newCategory) {
                const userData = await loadUserData();
                const userCategories = userData?.categories || [];
                const allCategories = [...defaultCategories, ...userCategories];
                
                if (!allCategories.includes(newCategory)) {
                    userCategories.push(newCategory);
                    await saveUserData({ categories: userCategories });
                    newCategoryInput.value = '';
                    renderCategories(userCategories, transactionCategorySelect);
                    showNotification('Category added successfully!', 'success');
                } else {
                    showNotification('Category already exists.', 'warning');
                }
            }
        });

        currencySelect.addEventListener('change', async (e) => {
            currencySymbol = e.target.value;
            await saveUserData({ currency: currencySymbol });
            updateSummary();
            renderTransactionList();
            showNotification('Currency updated!', 'success');
        });

        addTransactionForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const description = e.target.transactionDescription.value;
            const amount = parseFloat(e.target.transactionAmount.value);
            const type = e.target.transactionType.value;
            const category = e.target.transactionCategory.value;
            const paymentType = e.target.transactionPaymentType.value;
            const date = e.target.transactionDate.value || new Date().toISOString().substring(0, 10);

            if (isNaN(amount) || amount <= 0) {
                showNotification('Please enter a valid amount.', 'danger');
                return;
            }

            const transactions = (await loadUserData())?.transactions || [];
            const newTransaction = {
                id: Date.now(),
                description,
                amount,
                type,
                category,
                paymentType,
                date: new Date(date).toISOString()
            };
            transactions.push(newTransaction);
            await saveUserData({ transactions });

            showNotification('Transaction added!', 'success');
            e.target.reset();
            updateSummary();
            await renderTransactionList();
            await renderReports();
        });

        async function renderTransactionList(showAll = false) {
            transactionList.innerHTML = '';
            const allTransactions = (await loadUserData())?.transactions || [];
            allTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            let transactionsToDisplay;
            if (showAll) {
                transactionsToDisplay = allTransactions;
                seeMoreBtn.style.display = 'none';
            } else {
                transactionsToDisplay = allTransactions.slice(0, 5);
                if (allTransactions.length > 5) {
                    seeMoreBtn.style.display = 'block';
                } else {
                    seeMoreBtn.style.display = 'none';
                }
            }

            transactionsToDisplay.forEach(transaction => {
                const listItem = document.createElement('li');
                listItem.className = 'transaction-item';
                const amountClass = transaction.type === 'expense' ? 'expense-amount' : 'income-amount';
                listItem.innerHTML = `
                    <span class="description">${transaction.description} (${transaction.category} - ${transaction.paymentType})</span>
                    <div class="details">
                        <span class="amount ${amountClass}">${currencySymbol}${transaction.amount.toFixed(2)}</span>
                        <span class="date">${new Date(transaction.date).toLocaleDateString()}</span>
                        <div class="action-buttons">
                            <button class="edit-btn" onclick="editTransaction(${transaction.id})">Edit</button>
                            <button class="delete-btn" onclick="deleteTransaction(${transaction.id})">&times;</button>
                        </div>
                    </div>
                `;
                transactionList.appendChild(listItem);
            });
        }

        seeMoreBtn.addEventListener('click', () => {
            renderTransactionList(true);
        });

        async function editTransaction(id) {
            const userData = await loadUserData();
            const transaction = userData.transactions.find(t => t.id === id);
            if (transaction) {
                editTransactionIdInput.value = transaction.id;
                editDescriptionInput.value = transaction.description;
                editAmountInput.value = transaction.amount;
                editTypeSelect.value = transaction.type;
                editPaymentTypeSelect.value = transaction.paymentType;
                editDateInput.value = new Date(transaction.date).toISOString().substring(0, 10);
                
                // Set the category options for the edit form
                renderCategories(userData.categories, editCategorySelect);
                editCategorySelect.value = transaction.category;

                editModal.style.display = 'flex';
            }
        }

        cancelEditBtn.addEventListener('click', () => {
            editModal.style.display = 'none';
        });

        editTransactionForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = parseInt(editTransactionIdInput.value);
            const description = editDescriptionInput.value;
            const amount = parseFloat(editAmountInput.value);
            const type = editTypeSelect.value;
            const category = editCategorySelect.value;
            const paymentType = editPaymentTypeSelect.value;
            const date = editDateInput.value;

            if (isNaN(amount) || amount <= 0) {
                showNotification('Please enter a valid amount.', 'danger');
                return;
            }

            const userData = await loadUserData();
            const transactions = userData.transactions.map(t => {
                if (t.id === id) {
                    return {
                        ...t,
                        description,
                        amount,
                        type,
                        category,
                        paymentType,
                        date: new Date(date).toISOString()
                    };
                }
                return t;
            });
            await saveUserData({ transactions });
            
            showNotification('Transaction updated successfully!', 'success');
            editModal.style.display = 'none';
            updateSummary();
            await renderTransactionList();
            await renderReports();
        });

        async function deleteTransaction(id) {
            let transactions = (await loadUserData())?.transactions || [];
            transactions = transactions.filter(transaction => transaction.id !== id);
            await saveUserData({ transactions });
            showNotification('Transaction deleted!', 'info');
            updateSummary();
            await renderTransactionList();
            await renderReports();
        }

        async function updateSummary() {
            const transactions = (await loadUserData())?.transactions || [];
            const totalIncome = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);

            const totalExpense = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);

            const totalBalance = totalIncome - totalExpense;

            totalBalanceEl.textContent = `${currencySymbol}${totalBalance.toFixed(2)}`;
            totalIncomeEl.textContent = `${currencySymbol}${totalIncome.toFixed(2)}`;
            totalExpenseEl.textContent = `${currencySymbol}${totalExpense.toFixed(2)}`;

            totalBalanceEl.style.color = totalBalance >= 0 ? '#007bff' : '#dc3545';

            updateBudgetProgress(totalExpense);
        }

        function updateBudgetProgress(totalExpense) {
            if (monthlyBudget > 0) {
                const monthlyProgress = (totalExpense / monthlyBudget) * 100;
                budgetProgressBar.style.width = `${Math.min(monthlyProgress, 100)}%`;
                budgetProgressBar.textContent = `${Math.round(monthlyProgress)}%`;

                if (monthlyProgress >= 100) {
                    budgetProgressBar.style.backgroundColor = '#dc3545';
                    showNotification(`⚠️ Budget exceeded! You have spent ${currencySymbol}${totalExpense.toFixed(2)} this month.`, 'danger');
                } else if (monthlyProgress >= 90) {
                    budgetProgressBar.style.backgroundColor = '#ffc107';
                    showNotification('⚠️ You have used 90% of your monthly budget!', 'warning');
                } else if (monthlyProgress >= 80) {
                    budgetProgressBar.style.backgroundColor = '#ffc107';
                    showNotification('💡 You have used 80% of your monthly budget. Consider reducing expenses.', 'warning');
                } else {
                    budgetProgressBar.style.backgroundColor = '#28a745';
                }
            } else {
                budgetProgressBar.style.width = '0%';
                budgetProgressBar.textContent = 'Set a budget';
                budgetProgressBar.style.backgroundColor = '#e0e0e0';
            }
        }

        async function loadSettings() {
            const userData = await loadUserData();
            if (userData) {
                if (userData.budget) {
                    monthlyBudget = userData.budget;
                    budgetAmountInput.value = monthlyBudget > 0 ? monthlyBudget : '';
                }
                if (userData.currency) {
                    currencySymbol = userData.currency;
                    currencySelect.value = currencySymbol;
                }
                renderCategories(userData.categories, transactionCategorySelect);
            }
        }

        function renderCategories(userCategories = [], selectElement) {
            const allCategories = [...defaultCategories, ...userCategories];
            selectElement.innerHTML = '';
            allCategories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                selectElement.appendChild(option);
            });
        }

        async function renderReports() {
            const transactions = (await loadUserData())?.transactions || [];

            // Group transactions by month and year
            const monthlyData = {};
            const categoryData = {};
            const paymentMethodData = {};

            transactions.forEach(t => {
                const date = new Date(t.date);
                const monthYear = `${date.toLocaleString('default', { month: 'short' })} ${date.getFullYear()}`;
                
                if (!monthlyData[monthYear]) {
                    monthlyData[monthYear] = { income: 0, expense: 0 };
                }

                if (t.type === 'income') {
                    monthlyData[monthYear].income += t.amount;
                } else {
                    monthlyData[monthYear].expense += t.amount;
                    if (!categoryData[t.category]) {
                        categoryData[t.category] = 0;
                    }
                    categoryData[t.category] += t.amount;
                    
                    if (!paymentMethodData[t.paymentType]) {
                        paymentMethodData[t.paymentType] = 0;
                    }
                    paymentMethodData[t.paymentType] += t.amount;
                }
            });

            // Create data for monthly chart
            const monthlyLabels = Object.keys(monthlyData).sort((a, b) => new Date(a) - new Date(b));
            const monthlyIncome = monthlyLabels.map(label => monthlyData[label].income);
            const monthlyExpenses = monthlyLabels.map(label => monthlyData[label].expense);
            
            // Create data for category chart
            const categoryLabels = Object.keys(categoryData);
            const categoryExpenses = Object.values(categoryData);

            // Create data for payment method chart
            const paymentMethodLabels = Object.keys(paymentMethodData);
            const paymentMethodExpenses = Object.values(paymentMethodData);

            // Render monthly chart
            if (monthlyChart) monthlyChart.destroy();
            monthlyChart = new Chart(monthlyChartCanvas, {
                type: 'bar',
                data: {
                    labels: monthlyLabels,
                    datasets: [{
                        label: 'Income',
                        data: monthlyIncome,
                        backgroundColor: '#28a745'
                    }, {
                        label: 'Expenses',
                        data: monthlyExpenses,
                        backgroundColor: '#dc3545'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Render category chart
            if (categoryChart) categoryChart.destroy();
            const categoryColors = categoryLabels.map(() => `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 0.8)`);
            categoryChart = new Chart(categoryChartCanvas, {
                type: 'pie',
                data: {
                    labels: categoryLabels,
                    datasets: [{
                        data: categoryExpenses,
                        backgroundColor: categoryColors
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });

            // Render payment method chart
            if (paymentMethodChart) paymentMethodChart.destroy();
            const paymentMethodColors = paymentMethodLabels.map(() => `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 0.8)`);
            paymentMethodChart = new Chart(paymentMethodChartCanvas, {
                type: 'doughnut',
                data: {
                    labels: paymentMethodLabels,
                    datasets: [{
                        data: paymentMethodExpenses,
                        backgroundColor: paymentMethodColors
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    }
                }
            });
        }


        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }
        
        showRegisterBtn.addEventListener('click', (e) => {
            e.preventDefault();
            renderAuthView('register');
        });

        showLoginBtn.addEventListener('click', (e) => {
            e.preventDefault();
            renderAuthView('login');
        });
    </script>
</body>
</html>
